# VIBE Music Player App

Modern music streaming application built with Next.js 15, TypeScript, and Supabase. Features user authentication, playlist management, song sharing, bookmarking, and real-time music playback with comprehensive SEO optimization and responsive design.

## üöÄ Features

### Core Music Features
- **üéµ Music Streaming**: Advanced vinyl-style player with full controls (play/pause, skip, volume, progress)
- **üìù Playlist Management**: Create, edit, and manage personal playlists with descriptions and cover images
- **‚ù§Ô∏è Likes & Bookmarks**: Dual system - heart/like songs and bookmark favorites with unified More menu
- **üìä Trending System**: Real-time trending charts with daily/weekly/monthly periods
- **üîó Song Sharing**: Advanced sharing system with customizable links, expiration dates, and privacy controls
- **üïê Play History**: Automatic tracking of listening history for Recently Played feature

### User Experience
- **üë§ User Authentication**: Seamless email/password and Google OAuth with NextAuth.js
- **üì± Responsive Design**: Mobile-first approach with optimized layouts for all devices
- **üé® Modern UI**: Consistent More menu patterns, dark/light theme, and intuitive navigation
- **üß≠ Smart Navigation**: Dynamic breadcrumbs with contextual page titles
- **üîî Real-time Updates**: Live synchronization across all devices

### Technical Excellence
- **üîê Enterprise Security**: Comprehensive route protection and data isolation
- **üöÄ SEO Optimized**: Full Open Graph, Twitter Cards, and metadata for all pages
- **‚ö° Performance**: Optimized loading with React Query caching and efficient state management
- **‚ôø Accessibility**: WCAG compliant components with keyboard navigation support

## üõ† Tech Stack

### Frontend
- **Next.js 15.4.2** - React framework with App Router and server components
- **React 19.1.0** - Latest UI library with concurrent features
- **TypeScript** - Full type safety with strict mode
- **Tailwind CSS 4** - Modern styling with oklch color space and custom theme variables
- **shadcn/ui** - Premium component library based on Radix UI primitives
- **Zustand** - Lightweight state management for music player
- **React Query** - Advanced server state management with caching
- **NextAuth.js** - Enterprise-grade authentication

### Backend & Database
- **Supabase** - Backend as a Service (PostgreSQL database)
- **Next.js API Routes** - Server-side API endpoints
- **NextAuth.js** - Authentication middleware
- **bcrypt** - Password hashing

### Additional Libraries
- **React Player** - Advanced audio/video playback
- **Wavesurfer.js** - Interactive audio waveform visualization  
- **Lucide React** - Modern icon library with 1000+ icons
- **React Hook Form** - Performant form handling with validation
- **Zod** - TypeScript-first schema validation
- **Sonner** - Beautiful toast notifications
- **VinylPlayer** - Custom vinyl-style music player component

## üìã Prerequisites

- Node.js 18+ 
- npm, yarn, or pnpm
- Supabase account
- Google OAuth credentials (optional)

## üîß Installation

1. **Clone the repository**
```bash
git clone <repository-url>
cd music-player-app
```

2. **Install dependencies**
```bash
npm install
# or
yarn install
# or
pnpm install
```

3. **Set up environment variables**

Create a `.env.local` file in the root directory:

```env
# NextAuth Configuration
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-nextauth-secret-key

# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your-supabase-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key

# Google OAuth (Optional)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

4. **Set up Supabase database**

Run the following SQL commands in your Supabase SQL editor:

```sql
-- Create users table
CREATE TABLE users (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  email text UNIQUE NOT NULL,
  password text,
  name text,
  image text,
  provider text NOT NULL DEFAULT 'credentials' 
    CHECK (provider IN ('credentials', 'google')),
  created_at timestamptz DEFAULT timezone('utc'::text, now()) NOT NULL,
  updated_at timestamptz DEFAULT timezone('utc'::text, now()) NOT NULL,
  bio text
);

-- Create songs table
CREATE TABLE songs (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  title text NOT NULL,
  artist text NOT NULL,
  album text,
  duration integer DEFAULT 0 NOT NULL,
  url text NOT NULL,
  thumbnail text,
  lyrics text,
  uploaded_at timestamptz DEFAULT timezone('utc'::text, now()),
  plays integer DEFAULT 0,
  liked boolean DEFAULT false,
  created_at timestamptz DEFAULT timezone('utc'::text, now()),
  updated_at timestamptz DEFAULT timezone('utc'::text, now()),
  user_id bigint REFERENCES users(id) ON DELETE CASCADE,
  shared boolean DEFAULT false NOT NULL,
  image_data text
);

-- Create playlists table
CREATE TABLE playlists (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  name text NOT NULL,
  description text,
  cover_image text,
  created_at timestamptz DEFAULT timezone('utc'::text, now()),
  updated_at timestamptz DEFAULT timezone('utc'::text, now()),
  has_notification boolean DEFAULT false,
  user_id bigint REFERENCES users(id) ON DELETE CASCADE
);

-- Create playlist_songs junction table
CREATE TABLE playlist_songs (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  playlist_id uuid REFERENCES playlists(id) ON DELETE CASCADE NOT NULL,
  song_id uuid REFERENCES songs(id) ON DELETE CASCADE NOT NULL,
  position integer DEFAULT 0 NOT NULL,
  created_at timestamptz DEFAULT timezone('utc'::text, now())
);

-- Create bookmarks table
CREATE TABLE bookmarks (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  song_id uuid REFERENCES songs(id) ON DELETE CASCADE NOT NULL,
  created_at timestamptz DEFAULT timezone('utc'::text, now()),
  user_id bigint REFERENCES users(id) ON DELETE CASCADE
);

-- Create trending tables
CREATE TABLE trending_snapshots (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  period_type text NOT NULL CHECK (period_type IN ('daily', 'weekly', 'monthly')),
  snapshot_date date NOT NULL,
  created_at timestamptz DEFAULT timezone('utc'::text, now()) NOT NULL
);

CREATE TABLE trending_rankings (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  snapshot_id uuid REFERENCES trending_snapshots(id) ON DELETE CASCADE NOT NULL,
  song_id uuid REFERENCES songs(id) ON DELETE CASCADE NOT NULL,
  ranking integer NOT NULL,
  trending_score numeric NOT NULL,
  plays_count integer NOT NULL,
  play_increase_percent numeric DEFAULT 0,
  created_at timestamptz DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Create shared_songs table for sharing functionality
CREATE TABLE shared_songs (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  song_id uuid REFERENCES songs(id) ON DELETE CASCADE NOT NULL,
  user_id bigint REFERENCES users(id) ON DELETE CASCADE NOT NULL,
  share_id varchar UNIQUE NOT NULL,
  title text,
  description text,
  is_public boolean DEFAULT true,
  expires_at timestamptz,
  view_count integer DEFAULT 0,
  created_at timestamptz DEFAULT timezone('utc'::text, now()) NOT NULL,
  updated_at timestamptz DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Create likes table for user song likes
CREATE TABLE likes (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id bigint REFERENCES users(id) ON DELETE CASCADE NOT NULL,
  song_id uuid REFERENCES songs(id) ON DELETE CASCADE NOT NULL,
  created_at timestamptz DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Create play_history table for tracking user listening history
CREATE TABLE play_history (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id bigint REFERENCES users(id) ON DELETE CASCADE NOT NULL,
  song_id uuid REFERENCES songs(id) ON DELETE CASCADE NOT NULL,
  played_at timestamptz DEFAULT timezone('utc'::text, now()) NOT NULL,
  created_at timestamptz DEFAULT timezone('utc'::text, now())
);

-- Create indexes for performance
CREATE INDEX idx_songs_user_id ON songs(user_id);
CREATE INDEX idx_playlists_user_id ON playlists(user_id);
CREATE INDEX idx_bookmarks_user_id ON bookmarks(user_id);
CREATE UNIQUE INDEX idx_bookmarks_user_song ON bookmarks(user_id, song_id);
CREATE INDEX idx_likes_user_id ON likes(user_id);
CREATE UNIQUE INDEX idx_likes_user_song ON likes(user_id, song_id);
CREATE INDEX idx_play_history_user_id ON play_history(user_id);
CREATE INDEX idx_play_history_played_at ON play_history(played_at);
CREATE INDEX idx_shared_songs_share_id ON shared_songs(share_id);
```

5. **Run the development server**
```bash
npm run dev
# or
yarn dev
# or
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000) to view the application.

## üèó Architecture

### Project Structure
```
src/
‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/            # Authentication pages
‚îÇ   ‚îú‚îÄ‚îÄ (protected)/       # Protected routes
‚îÇ   ‚îú‚îÄ‚îÄ api/               # API routes
‚îÇ   ‚îî‚îÄ‚îÄ globals.css        # Global styles
‚îú‚îÄ‚îÄ components/            # React components
‚îÇ   ‚îú‚îÄ‚îÄ layout/           # Layout components
‚îÇ   ‚îú‚îÄ‚îÄ ui/               # shadcn/ui components
‚îÇ   ‚îî‚îÄ‚îÄ songs/            # Music-related components
‚îú‚îÄ‚îÄ lib/                  # Utility libraries
‚îú‚îÄ‚îÄ hooks/                # Custom React hooks
‚îú‚îÄ‚îÄ types/                # TypeScript type definitions
‚îî‚îÄ‚îÄ middleware.ts         # Next.js middleware
```

### Database Schema
- **users**: User accounts and authentication (with bio field)
- **songs**: Music tracks with metadata (with shared flag and image_data)
- **playlists**: User-created playlists with descriptions and cover images
- **playlist_songs**: Many-to-many relationship for playlist-song associations
- **bookmarks**: User's saved/bookmarked songs
- **likes**: User likes/hearts on songs (separate from bookmarks)
- **play_history**: Tracking of user's listening history
- **shared_songs**: Shareable song links with custom titles, descriptions, and expiration
- **trending_snapshots**: Trending calculation periods (daily/weekly/monthly)
- **trending_rankings**: Song rankings per trending period

### Authentication Flow
1. User visits protected route
2. Middleware checks authentication status
3. Unauthenticated users redirected to signin
4. NextAuth.js handles login with email/password or Google OAuth
5. Session stored in JWT tokens
6. API routes validate user sessions

## üö¶ Running the Application

### Development
```bash
npm run dev
```

### Production Build
```bash
npm run build
npm start
```

### Linting
```bash
npm run lint
```

## üîê Authentication & Security

### Authentication Methods
- **Email/Password**: Custom credentials with bcrypt hashing
- **Google OAuth**: Social login integration
- **Session Management**: JWT-based sessions with NextAuth.js

### Security Features
- **Route Protection**: Middleware-based authentication
- **API Security**: User session validation on all protected endpoints
- **Data Isolation**: Users can only access their own data
- **CSRF Protection**: Built-in NextAuth.js security
- **Password Security**: bcrypt hashing with salt rounds

### Protected Routes
- `/` - Main dashboard (requires authentication)
- `/trending` - Trending songs
- `/my-songs` - User's uploaded songs
- `/recently-played` - Recently played tracks
- `/playlist/*` - Playlist management
- `/api/songs` - Song management APIs
- `/api/playlists` - Playlist APIs
- `/api/bookmarks` - Bookmark APIs
- `/api/likes` - Like/heart APIs
- `/api/play-history` - Play history APIs
- `/api/shares` - Song sharing APIs

### Public Routes
- `/signin` - Authentication page
- `/signup` - User registration
- `/share/[shareId]` - Public shared song pages

## üìä Supabase Configuration

### Environment Variables
Set up the following in your Supabase project:
```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

### Row Level Security (RLS)
The application uses user_id based data isolation instead of RLS for simplicity. Each user's data is separated by user_id foreign keys.

### Real-time Features
- Live updates for playlist changes
- Real-time trending data
- Instant bookmark synchronization

## üé® UI/UX Features

### Design System
- **Dark/Light Theme**: Automatic theme switching
- **Custom Colors**: oklch color space for better color consistency
- **Typography**: Montserrat font family
- **Responsive**: Mobile-first design approach

### Components
- **VinylPlayer**: Custom vinyl-style music player with waveform visualization
- **Unified More Menu**: Consistent dropdown menus for song actions (bookmark, share, playlist add)
- **ShareModal**: Advanced sharing with custom titles, descriptions, and expiration dates
- **Dynamic Breadcrumb Navigation**: Context-aware navigation with page titles
- **Responsive Sidebar**: Collapsible navigation with user playlists
- **Mobile-First Design**: Optimized layouts for all screen sizes
- **Toast Notifications**: Beautiful notifications with Sonner

## üîß API Endpoints

### Songs
- `GET /api/songs` - Fetch all songs (public)
- `POST /api/songs` - Add new song (authenticated)
- `GET /api/songs/[id]` - Get specific song
- `PUT /api/songs/[id]` - Update song (owner only)
- `DELETE /api/songs/[id]` - Delete song (owner only)

### Playlists
- `GET /api/playlists` - Get user playlists (authenticated)
- `POST /api/playlists` - Create playlist (authenticated)
- `GET /api/playlists/[id]` - Get specific playlist
- `PUT /api/playlists/[id]` - Update playlist (owner only)
- `DELETE /api/playlists/[id]` - Delete playlist (owner only)

### Bookmarks
- `GET /api/bookmarks` - Get user bookmarks (authenticated)
- `POST /api/bookmarks` - Add bookmark (authenticated)
- `DELETE /api/bookmarks` - Remove bookmark (authenticated)

### Likes
- `GET /api/likes` - Get user likes (authenticated)
- `POST /api/likes` - Like a song (authenticated)
- `DELETE /api/likes` - Unlike a song (authenticated)

### Play History
- `GET /api/play-history` - Get user's recently played songs (authenticated)
- `POST /api/play-history` - Record song play (authenticated)

### Trending
- `GET /api/trending` - Get trending songs
- `GET /api/trending/stats` - Get trending statistics

### Shares
- `POST /api/shares` - Create shareable link (authenticated)
- `GET /api/shares/[shareId]` - Get shared song data (public)
- `GET /api/shares` - Get user's shared songs (authenticated)
- `DELETE /api/shares/[shareId]` - Delete shared song (owner only)

## üì± Development

### Adding New Features
1. Create components in appropriate directories
2. Add API routes in `src/app/api/`
3. Update database schema if needed
4. Add proper TypeScript types
5. Update middleware for route protection if needed

### State Management
- **Zustand Store**: Global music player state, songs, playlists, bookmarks
- **React Query**: Server state and caching with automatic invalidation
- **React Hook Form**: Form state management with Zod validation
- **Custom Hooks**: useShare for sharing functionality, useIsMobile for responsive design

## üöÄ Deployment

### Vercel (Recommended)
1. Connect your repository to Vercel
2. Set environment variables in Vercel dashboard
3. Deploy automatically on push to main branch

### Other Platforms
The app can be deployed on any platform that supports Next.js:
- Netlify
- Railway
- Digital Ocean
- AWS Amplify

### Environment Setup for Production
- Set all required environment variables
- Configure Supabase with production database
- Set up Google OAuth credentials for production domain
- Configure domain for NEXTAUTH_URL

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Open a Pull Request

## üìÑ License

This project is licensed under the MIT License.

## ‚ú® Recent Updates

### Version 2.0 Features
- **üîó Advanced Song Sharing**: Create customizable share links with titles, descriptions, and expiration dates
- **üì± Unified More Menu System**: Consistent dropdown menus across all pages (songs, playlists, bookmarks)
- **üéØ SEO Optimization**: Complete Open Graph and Twitter Cards support for all pages
- **üìã Enhanced Navigation**: Dynamic breadcrumbs with contextual page titles
- **üé® Improved UI/UX**: Better responsive design with mobile-first approach
- **‚ö° Performance Optimizations**: React Query caching and efficient state management
- **üîê Enhanced Security**: Comprehensive route protection and data validation

### Technical Improvements
- Upgraded to Next.js 15.4.2 with React 19
- Implemented Tailwind CSS 4 with oklch color space
- Added comprehensive TypeScript strict mode
- Enhanced mobile responsiveness with useIsMobile hook
- Improved error handling and user feedback

## üÜò Support

For support, please open an issue on GitHub or contact the development team.

---

**VIBE Music** - Experience music like never before üéµ